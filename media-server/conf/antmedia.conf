# ============================================================================
# StreamLick Ant Media Server Configuration
# Maximum Stability Settings for YouTube/Facebook/Twitch Streaming
# ============================================================================
# Location: /usr/local/antmedia/conf/antmedia.conf
# ============================================================================

# ------------- CORE STABILITY -------------

# Enable both WebRTC and RTMP simultaneously
WebRTCEnabled=true
RTMPEnabled=true
EnabledWriteStatsToDatastore=true

# ------------- NETWORK TUNING (ICE/TURN) -------------

# Primary STUN server
ICEServers=stun:stun.l.google.com:19302
UseExternalIceCandidate=true

# TURN Server Configuration (HIGHLY RECOMMENDED for NAT traversal)
# Uncomment and configure if you have a TURN server
#TurnServerUrl=turn:media.streamlick.com:3478
#TurnServerUsername=streamlick
#TurnServerPassword=CHANGE_ME_TO_SECURE_PASSWORD

# Enable TCP candidates for restrictive firewalls
WebRTCTcpCandidatesEnabled=true

# ------------- WEBRTC BUFFERING/LATENCY -------------

# Target 30fps for stability (NOT 60fps)
WebRTCFrameRate=30

# Frame sending period in ms (1000/30 = 33.33ms)
WebRTCFrameSendingPeriod=33

# Bandwidth limits (kbps)
# 3500kbps is optimal for 1080p streaming to YouTube/FB
WebRTCMaxBandwidth=3500
WebRTCMinBitrate=500

# Prevent random bitrate spikes
StaticAspectRatio=true

# ------------- ENCODER STABILITY -------------

# Enable transcoding
TranscoderEnabled=true

# Auto-detect optimal encoding threads (most stable)
EncodingThreads=0

# CRITICAL: Force keyframe every 2 seconds for YouTube, Facebook, Twitch
# At 30fps: 2 seconds = 60 frames
EncoderKeyFrameInterval=2

# Encoder presets for CBR-like behavior (prevents "unstable stream" warnings)
EncoderPreset=veryfast
EncoderLevel=42
EncoderProfile=high

# ------------- FILE RECORDING (Pipeline Stability) -------------

# Keep consistent settings even if not using recording
# This stabilizes the encoding pipeline
Mp4MuxingEnabled=true
Mp4MuxingFinishTimeout=20000

# ------------- BUFFER SAFETY (Jitter Prevention) -------------

# Avoid "stream is lagging" dropouts on heavy CPU
JitterBufferEnabled=true
JitterBufferSuccessfulSendThreshold=2

# ------------- RTMP PUSH RECONNECTION -------------

# For resilient multi-destination streaming
ReconnectionAttemptCount=10
ReconnectionDelayMillis=3000
PushPublishTimeoutSec=60

# ------------- STREAM SECURITY -------------

# Token control - enable in production for security
TokenControlEnabled=false

# ------------- LOGGING -------------

# Keep logs detailed enough for debugging but not overwhelming
ServerLogLevel=INFO

# ------------- ADVANCED SETTINGS -------------

# GOP (Group of Pictures) settings
# 60 frames at 30fps = 2 second keyframe interval
gopSize=60

# Adaptive bitrate settings (disable for constant quality)
# settings.enableAdaptiveBitrate=false

# WebRTC data channel settings
# dataChannelEnabled=true

# ============================================================================
# END OF CONFIGURATION
# ============================================================================
